<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>English Flashcards Track UI</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<style>
  :root {
    --primary-blue: #6DA7F2;
    --bg-blue-light: rgba(109, 167, 242, 0.15);
    --delete-red: #d9534f;
  }

  body {
    font-family: 'Pretendard', sans-serif;
    padding: 30px;
    max-width: 900px;
    margin: auto;
  }

  h1 { text-align: center; color: var(--primary-blue); margin-bottom: 30px; }

  /* 버튼 및 입력창 라인 색상 고정 */
  button, input, table, th, td {
    border: 1px solid var(--primary-blue) !important;
  }

  .controls { text-align: center; margin-bottom: 20px; }

  button {
    background-color: var(--bg-blue-light);
    color: var(--primary-blue);
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 6px;
    font-weight: bold;
    transition: 0.2s;
  }
  button:hover { background-color: var(--primary-blue); color: white; }

  .input-row { display: flex; gap: 10px; margin-bottom: 30px; }
  input { flex: 1; padding: 12px; border-radius: 4px; outline: none; }

  /* 테이블 컬럼 고정 및 트랙 스타일 */
  .table-container { position: relative; margin-right: 50px; } /* 아이콘 영역 확보 */

  table { 
    width: 100%; 
    border-collapse: collapse; 
    table-layout: fixed; /* 컬럼 너비 고정 */
  }

  th { background-color: var(--bg-blue-light); padding: 12px; }
  
  tr { position: relative; } /* 아이콘 배치를 위한 기준 */

  td { 
    padding: 15px; 
    text-align: center; 
    word-break: break-all; 
    height: 50px;
    vertical-align: middle;
    position: relative;
  }

  /* 가리기 상태: Eye 아이콘 중앙 정렬 */
  .hidden { 
    color: transparent !important; 
    background-color: #efefefb8 !important;
    cursor: pointer;
  }
  .hidden::after {
    font-family: "bootstrap-icons";
    content: "\f33e"; /* bi-eye */
    color: var(--primary-blue);
    font-size: 22px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    visibility: visible;
  }

  /* 트랙 우측 아이콘 그룹 (이미지 스타일 반영) */
  .track-actions {
    position: absolute;
    right: -45px; /* 테이블 바깥 우측에 배치 */
    top: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 5px;
    border: 1px solid var(--primary-blue);
    border-left: none; /* 테이블과 연결된 느낌 */
    padding: 5px;
    background: white;
    border-radius: 0 4px 4px 0;
  }

  .btn-icon {
    background: none !important;
    border: none !important;
    padding: 0;
    font-size: 20px;
    line-height: 1;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .btn-edit { color: var(--primary-blue); }
  .btn-delete { color: var(--delete-red); }

  .file-ops { margin-top: 30px; display: flex; justify-content: space-between; }
  #csvInput { display: none; }
</style>
</head>
<body>

<h1>English Flashcards</h1>

<div class="controls">
  <button id="modeBtn" onclick="rotateMode()">둘 다 보기</button>
</div>

<div class="file-ops">
  <div>
    <button onclick="document.getElementById('csvInput').click()">CSV 불러오기</button>
    <input type="file" id="csvInput" accept=".csv" onchange="importCSV(event)">
  </div>
  <button onclick="exportCSV()" style="background-color: white;">CSV 다운로드</button>
</div>

<br>

<div class="input-row">
  <input id="sentenceInput" placeholder="영어 문장을 입력하세요">
  <input id="meaningInput" placeholder="뜻을 입력하세요">
  <button onclick="addRow()">등록</button>
</div>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th style="width: 50%;">문장</th>
        <th style="width: 50%;">뜻</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>


<script>
let cardData = JSON.parse(localStorage.getItem('flashcards')) || [];
let currentMode = 0; 
const modeLabels = ["둘 다 보기", "문장만 보기", "뜻만 보기"];

window.onload = renderTable;

function rotateMode() {
  currentMode = (currentMode + 1) % 3;
  document.getElementById('modeBtn').innerText = `${modeLabels[currentMode]}`;
  renderTable();
}

function save() {
  localStorage.setItem('flashcards', JSON.stringify(cardData));
  renderTable();
}

function addRow() {
  const s = document.getElementById('sentenceInput').value.trim();
  const m = document.getElementById('meaningInput').value.trim();
  if(!s || !m) return alert("문장과 뜻을 모두 입력하세요.");
  
  cardData.push({ s, m });
  document.getElementById('sentenceInput').value = "";
  document.getElementById('meaningInput').value = "";
  save();
}

function deleteRow(index) {
  if(confirm("이 문장을 삭제할까요?")) {
    cardData.splice(index, 1);
    save();
  }
}

function editRow(index) {
  const newS = prompt("문장 수정:", cardData[index].s);
  const newM = prompt("뜻 수정:", cardData[index].m);
  if(newS && newM) {
    cardData[index] = { s: newS, m: newM };
    save();
  }
}

function renderTable() {
  const tbody = document.getElementById('tableBody');
  tbody.innerHTML = "";

  cardData.forEach((item, idx) => {
    const tr = document.createElement('tr');
    
    // 모드에 따른 클래스 설정
    const sClass = currentMode === 2 ? 'hidden' : '';
    const mClass = currentMode === 1 ? 'hidden' : '';

    tr.innerHTML = `
      <td class="${sClass}" onclick="this.classList.remove('hidden')">${item.s}</td>
      <td class="${mClass}" onclick="this.classList.remove('hidden')">${item.m}</td>
      <div class="track-actions">
        <button class="btn-icon btn-edit" onclick="editRow(${idx})"><i class="bi bi-box-arrow-up-right"></i></button>
        <button class="btn-icon btn-delete" onclick="deleteRow(${idx})"><i class="bi bi-x-circle"></i></button>
      </div>
    `;
    tbody.appendChild(tr);
  });
}

function exportCSV() {
  if (cardData.length === 0) return alert("데이터가 없습니다.");
  let csv = "\uFEFFSentence,Meaning\n";
  cardData.forEach(row => { csv += `"${row.s}","${row.m}"\n`; });
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'flashcards.csv';
  a.click();
}

function importCSV(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    const text = e.target.result;
    const lines = text.split('\n').filter(l => l.trim() !== "").slice(1);
    const newData = lines.map(line => {
      const parts = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      return { s: parts[0].replace(/"/g, '').trim(), m: parts[1].replace(/"/g, '').trim() };
    });
    if(confirm(`${newData.length}개의 데이터를 가져오시겠습니까?`)) {
      cardData = newData;
      save();
    }
  };
  reader.readAsText(file);
}
</script>

</body>
</html>
