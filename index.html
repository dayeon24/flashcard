<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>English Flashcards Track UI</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<style>
  :root {
    --primary-blue: #6DA7F2;
    --bg-blue-light: rgba(109, 167, 242, 0.15);
    --delete-red: #d9534f;
    --bookmark-orange: #ff9800;
  }

  body {
    font-family: 'Pretendard', sans-serif;
    padding: 30px;
    max-width: 900px;
    margin: auto;
  }

  h1 { text-align: center; color: var(--primary-blue); margin-bottom: 30px; }

  button, input, table, th, td {
    border: 1px solid var(--primary-blue) !important;
  }

  .controls { text-align: center; margin-bottom: 20px; }

  button {
    background-color: var(--bg-blue-light);
    color: var(--primary-blue);
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 6px;
    font-weight: bold;
    transition: 0.2s;
  }
  button:hover { background-color: var(--primary-blue); color: white; }

  .input-row { display: flex; gap: 10px; margin-bottom: 30px; }
  input { flex: 1; padding: 12px; border-radius: 4px; outline: none; }

  /* 테이블 컨테이너: 좌우 아이콘 공간 확보 */
  .table-container { 
    position: relative; 
    margin: 0 60px; /* 좌우 여백 */
  }

  table { 
    width: 100%; 
    border-collapse: collapse; 
    table-layout: fixed; 
  }

  th { background-color: var(--bg-blue-light); padding: 12px; }
  
  /* 행에 상대 위치 부여 */
  tbody tr { 
    position: relative;
    height: 60px;
  }

  td { 
    padding: 15px; 
    text-align: center; 
    word-break: break-all;
    vertical-align: middle;
    position: relative;
    background: white;
  }

  /* 가리기 상태 */
  .hidden { 
    color: transparent !important; 
    background-color: #f8f9fa !important;
    cursor: pointer;
  }
  .hidden::after {
    font-family: "bootstrap-icons";
    content: "\f33e";
    color: var(--primary-blue);
    font-size: 22px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    visibility: visible;
  }

  /* 왼쪽 북마크 아이콘 */
  .bookmark-icon {
    position: absolute;
    left: -60px;
    top: 0;
    bottom: 0;
    width: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border: 1px solid var(--primary-blue);
    border-right: none;
    border-radius: 6px 0 0 6px;
    cursor: pointer;
    font-size: 24px;
    color: var(--bookmark-orange);
  }

  /* 오른쪽 액션 아이콘 그룹 */
  .action-icons {
    position: absolute;
    right: -60px;
    top: 0;
    bottom: 0;
    width: 50px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background: white;
    border: 1px solid var(--primary-blue);
    border-left: none;
    border-radius: 0 6px 6px 0;
    padding: 5px 0;
  }

  .btn-icon {
    background: none !important;
    border: none !important;
    padding: 0;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .btn-edit { color: var(--primary-blue); }
  .btn-delete { color: var(--delete-red); }

  .file-ops { margin-top: 30px; display: flex; justify-content: space-between; }
  #csvInput { display: none; }
</style>
</head>
<body>

<h1>English Flashcards</h1>

<div class="controls">
  <button id="modeBtn" onclick="rotateMode()">둘 다 보기</button>
</div>

<div class="file-ops">
  <div>
    <button onclick="document.getElementById('csvInput').click()">CSV 불러오기</button>
    <input type="file" id="csvInput" accept=".csv" onchange="importCSV(event)">
  </div>
  <button onclick="exportCSV()" style="background-color: white;">CSV 다운로드</button>
</div>

<br>

<div class="input-row">
  <input id="sentenceInput" placeholder="영어 문장을 입력하세요">
  <input id="meaningInput" placeholder="뜻을 입력하세요">
  <button onclick="addRow()">등록</button>
</div>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th style="width: 50%;">문장</th>
        <th style="width: 50%;">뜻</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<script>
let cardData = JSON.parse(localStorage.getItem('flashcards')) || [];
let currentMode = 0; 
const modeLabels = ["둘 다 보기", "문장만 보기", "뜻만 보기"];

window.onload = renderTable;

function rotateMode() {
  currentMode = (currentMode + 1) % 3;
  document.getElementById('modeBtn').innerText = `${modeLabels[currentMode]}`;
  renderTable();
}

function save() {
  localStorage.setItem('flashcards', JSON.stringify(cardData));
  renderTable();
}

function addRow() {
  const s = document.getElementById('sentenceInput').value.trim();
  const m = document.getElementById('meaningInput').value.trim();
  if(!s || !m) return alert("문장과 뜻을 모두 입력하세요.");
  
  cardData.push({ s, m, bookmarked: false });
  document.getElementById('sentenceInput').value = "";
  document.getElementById('meaningInput').value = "";
  save();
}

function toggleBookmark(idx) {
  cardData[idx].bookmarked = !cardData[idx].bookmarked;
  save();
}

function deleteRow(idx) {
  if(confirm("이 문장을 삭제할까요?")) {
    cardData.splice(idx, 1);
    save();
  }
}

function editRow(idx) {
  const newS = prompt("문장 수정:", cardData[idx].s);
  const newM = prompt("뜻 수정:", cardData[idx].m);
  if(newS && newM) {
    cardData[idx] = { ...cardData[idx], s: newS, m: newM };
    save();
  }
}

function renderTable() {
  const tbody = document.getElementById('tableBody');
  tbody.innerHTML = "";

  cardData.forEach((item, idx) => {
    const tr = document.createElement('tr');
    
    const sClass = currentMode === 2 ? 'hidden' : '';
    const mClass = currentMode === 1 ? 'hidden' : '';
    const bookmarkIcon = item.bookmarked ? 'bi-bookmark-fill' : 'bi-bookmark';

    // 첫 번째 td에만 북마크 아이콘 추가
    const td1 = document.createElement('td');
    td1.className = sClass;
    td1.textContent = item.s;
    td1.onclick = function() { this.classList.remove('hidden'); };
    
    // 북마크 아이콘 생성
    const bookmarkDiv = document.createElement('div');
    bookmarkDiv.className = 'bookmark-icon';
    bookmarkDiv.innerHTML = `<i class="bi ${bookmarkIcon}"></i>`;
    bookmarkDiv.onclick = () => toggleBookmark(idx);
    td1.appendChild(bookmarkDiv);

    // 두 번째 td
    const td2 = document.createElement('td');
    td2.className = mClass;
    td2.textContent = item.m;
    td2.onclick = function() { this.classList.remove('hidden'); };
    
    // 액션 아이콘 그룹 생성
    const actionsDiv = document.createElement('div');
    actionsDiv.className = 'action-icons';
    actionsDiv.innerHTML = `
      <button class="btn-icon btn-edit" onclick="editRow(${idx})"><i class="bi bi-pencil"></i></button>
      <button class="btn-icon btn-delete" onclick="deleteRow(${idx})"><i class="bi bi-x-circle"></i></button>
    `;
    td2.appendChild(actionsDiv);

    tr.appendChild(td1);
    tr.appendChild(td2);
    tbody.appendChild(tr);
  });
}

function exportCSV() {
  if (cardData.length === 0) return alert("데이터가 없습니다.");
  let csv = "\uFEFFSentence,Meaning,Bookmarked\n";
  cardData.forEach(row => { 
    csv += `"${row.s}","${row.m}","${row.bookmarked || false}"\n`; 
  });
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'flashcards.csv';
  a.click();
}

function importCSV(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    const text = e.target.result;
    const lines = text.split('\n').filter(l => l.trim() !== "").slice(1);
    const newData = lines.map(line => {
      const parts = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      return { 
        s: parts[0].replace(/"/g, '').trim(), 
        m: parts[1] ? parts[1].replace(/"/g, '').trim() : "",
        bookmarked: parts[2] ? parts[2].replace(/"/g, '').trim() === 'true' : false
      };
    });
    if(confirm(`${newData.length}개의 데이터를 가져오시겠습니까?`)) {
      cardData = newData;
      save();
    }
  };
  reader.readAsText(file);
}
</script>

</body>
</html>
